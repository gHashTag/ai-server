# üí∞ Invest in Competitor - –ò—Ç–æ–≥–æ–≤–æ–µ —Ä–µ–∑—é–º–µ

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `investInCompetitor`
**–§–∞–π–ª:** `src/inngest-functions/investInCompetitor.ts`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
1. **–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è** –Ω–∞ Instagram –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞ –ø–æ username
2. **–ó–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥** —Ä–∏–ª–∑–æ–≤ —á–µ—Ä–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π Apify —Å–∫—Ä–∞–ø–µ—Ä  
3. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç** N —Ä–∏–ª–∑–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
4. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é 1 –ª—É—á—à–∏–π —Ä–∏–ª–∑ —Å—Ä–∞–∑—É
5. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üîÑ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
**–§–∞–π–ª—ã:** 
- `src/inngest-functions/competitorAutoParser.ts` (–æ–±–Ω–æ–≤–ª–µ–Ω)
- `src/inngest-functions/competitorDelivery.ts`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ö–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ –≤ 08:00 UTC –ø–∞—Ä—Å–∏—Ç –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏ (digest/individual/archive)

### üåê API Endpoints
**–§–∞–π–ª:** `src/routes/investCompetitor.route.ts`

- `POST /api/invest-competitor` - –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
- `GET /api/invest-competitor/status/:username` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `POST /api/invest-competitor/trigger-delivery/:username` - —Ä—É—á–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `competitor_subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `competitor_profiles` - –∫—ç—à –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤  
- `competitor_delivery_history` - –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∞–≤–æ–∫
- `instagram_apify_reels` - —Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–µ —Ä–∏–ª–∑—ã

## üìã –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ß–µ—Ä–µ–∑ API:
```bash
curl -X POST http://localhost:3000/api/invest-competitor \
  -H "Content-Type: application/json" \
  -d '{
    "username": "natgeo",
    "user_telegram_id": "144022504", 
    "bot_name": "neuro_blogger_bot",
    "max_reels": 10
  }'
```

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç:
```javascript
bot.command('invest', async (ctx) => {
  const username = ctx.message.text.split(' ')[1]
  
  await fetch('/api/invest-competitor', {
    method: 'POST',
    body: JSON.stringify({
      username: username,
      user_telegram_id: ctx.from.id.toString(),
      bot_name: 'your_bot_name'
    })
  })
})
```

## üé¨ –°—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/invest @natgeo`
2. **–°–∏—Å—Ç–µ–º–∞** —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥–ø–∏—Å–∫—É –≤ –ë–î
3. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ Apify (15-30 —Å–µ–∫)
4. **–°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** 10 –ª—É—á—à–∏—Ö —Ä–∏–ª–∑–æ–≤ –≤ –±–∞–∑—É
5. **–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è** 1 –ª—É—á—à–∏–π —Ä–∏–ª–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é  
6. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è** –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```
‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ @natgeo!

üé¨ –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∏–ª–∑ –æ—Ç @natgeo:
üëÅ 1,234,567 –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
‚ù§Ô∏è 89,123 –ª–∞–π–∫–æ–≤
üéµ Artist - Song Name

üîó https://instagram.com/p/ABC123/
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ö–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ —Å–∏—Å—Ç–µ–º–∞:**
1. –ü–∞—Ä—Å–∏—Ç –Ω–æ–≤—ã–µ —Ä–∏–ª–∑—ã –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
2. –§–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç—ã –Ω–æ–≤—ã—Ö —Ä–∏–ª–∑–æ–≤

**–§–æ—Ä–º–∞—Ç—ã –¥–æ—Å—Ç–∞–≤–∫–∏:**
- `digest` - –∫—Ä–∞—Ç–∫–∏–π –¥–∞–π–¥–∂–µ—Å—Ç —Å —Ç–æ–ø —Ä–∏–ª–∑–æ–º
- `individual` - –∫–∞–∂–¥—ã–π —Ä–∏–ª–∑ –æ—Ç–¥–µ–ª—å–Ω–æ 
- `archive` - Excel —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ —Ä–∏–ª–∑–∞–º–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç:
```bash
export $(cat .env.temp | xargs) && node test-invest-simple.js
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏:
```bash
export $(cat .env.temp | xargs) && node test-invest-simple.js --create-test
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API:
```bash
curl "http://localhost:3000/api/invest-competitor/status/natgeo?user_telegram_id=144022504&bot_name=neuro_blogger_bot"
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
SELECT COUNT(*) FROM competitor_subscriptions WHERE is_active = true;

-- –¢–æ–ø –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã –ø–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
SELECT competitor_username, COUNT(*) as subscribers 
FROM competitor_subscriptions 
GROUP BY competitor_username 
ORDER BY subscribers DESC;

-- –†–∏–ª–∑—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
SELECT owner_username, COUNT(*) as reels_count
FROM instagram_apify_reels 
GROUP BY owner_username;
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ï–¥–∏–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞** - –æ–¥–∏–Ω –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
2. **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –ª—É—á—à–∏–π —Ä–∏–ª–∑
3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - –Ω–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏
4. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** - –∫–∞–∂–¥—ã–π –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–≤–æ–∏ —Ñ–∏–ª—å—Ç—Ä—ã
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Ç–µ—Ç –≤–º–µ—Å—Ç–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TD
    A[User Request] --> B[investInCompetitor]
    B --> C[Create Subscription]
    B --> D[Trigger Apify Parsing]
    D --> E[Save to DB]
    E --> F[Return Best Reel]
    
    G[Daily Cron] --> H[competitorAutoParser]
    H --> I[Parse All Competitors]
    I --> J[competitorDelivery]
    J --> K[Send Updates to Users]
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º** - –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/invest` –≤ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
2. **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - —Å–æ–∑–¥–∞—Ç—å UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏
3. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** - –¥–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ä–∏–ª–∑–æ–≤
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ç–æ–ø–æ–≤—ã—Ö —Ä–∏–ª–∑–∞—Ö
5. **AI-—Ñ–∏–ª—å—Ç—Ä—ã** - —É–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É

---

**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.