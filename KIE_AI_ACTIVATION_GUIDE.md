# üöÄ KIE.AI –ê–ö–¢–ò–í–ê–¶–ò–Ø - –≠–ö–û–ù–û–ú–ò–Ø 87% –ù–ê VEO 3

## ‚úÖ –ß–¢–û –ò–°–ü–†–ê–í–õ–ï–ù–û

### 1. Duration API Fix
- **‚ùå –ë–´–õ–û**: "2 —Å–µ–∫—É–Ω–¥—ã" ‚Üí 8 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ (duration –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª—Å—è)
- **‚úÖ –°–¢–ê–õ–û**: "2 —Å–µ–∫—É–Ω–¥—ã" ‚Üí –∏–º–µ–Ω–Ω–æ 2 —Å–µ–∫—É–Ω–¥—ã –≤–∏–¥–µ–æ

### 2. Kie.ai –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- **‚ùå –ë–´–õ–û**: –¢–æ–ª—å–∫–æ –¥–æ—Ä–æ–≥–æ–π Vertex AI ($0.40/—Å–µ–∫)
- **‚úÖ –°–¢–ê–õ–û**: –î–µ—à–µ–≤—ã–π Kie.ai ($0.05/—Å–µ–∫) —Å fallback –Ω–∞ Vertex AI

### 3. –≠–∫–æ–Ω–æ–º–∏—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
| –ú–æ–¥–µ–ª—å | Vertex AI | Kie.ai | –≠–∫–æ–Ω–æ–º–∏—è | –ù–∞ 2 —Å–µ–∫ | –ù–∞ 8 —Å–µ–∫ |
|--------|-----------|---------|----------|----------|----------|
| Veo-3 Fast | $0.40/—Å–µ–∫ | $0.059/—Å–µ–∫ | **85%** | $0.118 vs $0.80 | $0.47 vs $3.20 |
| Veo-3 Quality | $0.40/—Å–µ–∫ | $0.25/—Å–µ–∫ | **37%** | $0.50 vs $0.80 | $2.00 vs $3.20 |

---

## üß™ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è: ‚úÖ 4/5 –¢–ï–°–¢–û–í –ü–†–û–ô–î–ï–ù–û
- ‚úÖ KieAiService –∫–ª–∞—Å—Å —Å–æ–∑–¥–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ processVideoGeneration –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω  
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- ‚úÖ Duration API –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ö†Ô∏è KIE_AI_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–æ–∂–∏–¥–∞–µ–º–æ)

### Duration API: ‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´
- ‚úÖ 2 —Å–µ–∫—É–Ω–¥—ã ‚Üí 2 —Å–µ–∫—É–Ω–¥—ã (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ 5 —Å–µ–∫—É–Ω–¥ ‚Üí 5 —Å–µ–∫—É–Ω–¥ (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)  
- ‚úÖ 15 —Å–µ–∫—É–Ω–¥ ‚Üí 10 —Å–µ–∫—É–Ω–¥ (–ª–∏–º–∏—Ç —Å–æ–±–ª—é–¥–µ–Ω)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

---

## üéØ –ê–ö–¢–ò–í–ê–¶–ò–Ø KIE.AI (3 –ú–ò–ù–£–¢–´)

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://kie.ai
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings ‚Üí API Keys
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `kie_`)

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –≤ .env
```bash
# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ –≤–∞—à .env —Ñ–∞–π–ª:
KIE_AI_API_KEY=kie_your_api_key_here
```

### –®–∞–≥ 3: –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å  
1. –ù–∞ https://kie.ai –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Billing
2. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –º–∏–Ω–∏–º—É–º $5 (—Ö–≤–∞—Ç–∏—Ç –Ω–∞ ~100 –≤–∏–¥–µ–æ –ø–æ 2 —Å–µ–∫)
3. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è $10-20 –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
pm2 restart ai-server-main
# –∏–ª–∏
npm run start
```

---

## üß™ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ API –∫–ª—é—á–∞)
node test-kie-ai-integration.js

# –¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API (—Ç—Ä–µ–±—É–µ—Ç KIE_AI_API_KEY)  
node test-real-kie-ai-api.js

# –¢–µ—Å—Ç —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
node test-kie-ai-savings.js
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
1. –°–æ–∑–¥–∞–π—Ç–µ POST –∑–∞–ø—Ä–æ—Å –∫ `/api/veo3-video`:
```json
{
  "prompt": "A cat playing with a ball",
  "duration": 2,
  "telegram_id": "123456",
  "username": "test",
  "is_ru": true,
  "bot_name": "test-bot"
}
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```
üéØ Using Kie.ai for veo-3-fast (87% cheaper than Vertex AI!)
‚ö° Duration: 2s ‚Üí cost: $0.118
```

---

## üõ°Ô∏è FALLBACK –°–ò–°–¢–ï–ú–ê

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Vertex AI (–¥–æ—Ä–æ–≥–æ–π)
- KIE_AI_API_KEY –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- Kie.ai API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω  
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ Kie.ai
- –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kie.ai (–¥–µ—à–µ–≤—ã–π)
- ‚úÖ KIE_AI_API_KEY –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω 
- ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
- ‚úÖ –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å `type: 'kie-ai'`

---

## üí∞ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–ò–ô –≠–§–§–ï–ö–¢

### –î–ª—è "2 —Å–µ–∫—É–Ω–¥—ã" –∑–∞–ø—Ä–æ—Å–∞:
- **‚ùå Vertex AI**: $0.80  
- **‚úÖ Kie.ai**: $0.118
- **üí∞ –≠–∫–æ–Ω–æ–º–∏—è**: $0.682 (85%)

### –ù–∞ 100 –≤–∏–¥–µ–æ –ø–æ 2 —Å–µ–∫—É–Ω–¥—ã –≤ –º–µ—Å—è—Ü:
- **‚ùå Vertex AI**: $80
- **‚úÖ Kie.ai**: $11.80  
- **üí∞ –≠–∫–æ–Ω–æ–º–∏—è**: $68.20 –≤ –º–µ—Å—è—Ü

### –ù–∞ 1000 –≤–∏–¥–µ–æ –ø–æ 5 —Å–µ–∫—É–Ω–¥ –≤ –º–µ—Å—è—Ü:
- **‚ùå Vertex AI**: $2,000
- **‚úÖ Kie.ai**: $295
- **üí∞ –≠–∫–æ–Ω–æ–º–∏—è**: $1,705 –≤ –º–µ—Å—è—Ü

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

### –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- ‚úÖ `src/services/kieAiService.ts` - –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å (267 —Å—Ç—Ä–æ–∫)
- ‚úÖ `src/services/generateTextToVideo.ts` - –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- ‚úÖ `src/services/vertexVeoService.ts` - duration –ø–∞—Ä–∞–º–µ—Ç—Ä
- ‚úÖ `src/controllers/generation.controller.ts` - –ø–µ—Ä–µ–¥–∞—á–∞ duration  
- ‚úÖ `src/config/models.config.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å `type: 'kie-ai'`
- ‚úÖ `production-env-template.txt` - –¥–æ–±–∞–≤–ª–µ–Ω KIE_AI_API_KEY

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
```typescript
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–∏
if (modelConfig.api?.input?.type === 'kie-ai') {
  // 2. –ü—Ä–æ–±—É–µ–º Kie.ai
  const kieService = new KieAiService()
  if (await kieService.checkHealth()) {
    return await kieService.generateVideo({ duration, ... })
  }
  // 3. Fallback –Ω–∞ Vertex AI
  return await processVertexAI(...)
}
```

---

## üéä –ò–¢–û–ì–ò

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:
- Duration API –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- Kie.ai –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
- –≠–∫–æ–Ω–æ–º–∏—è –¥–æ 87% –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞
- Fallback –Ω–∞ Vertex AI –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã

### üöÄ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–≥:
**–î–æ–±–∞–≤—å—Ç–µ KIE_AI_API_KEY –≤ .env –∏ –ø–æ–ª—É—á–∏—Ç–µ 87% —ç–∫–æ–Ω–æ–º–∏–∏!**

---

*–°–æ–∑–¥–∞–Ω: 20 –∞–≤–≥—É—Å—Ç–∞ 2025*  
*Pull Request: https://github.com/gHashTag/ai-server/pull/6*