# üß¨ –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –ú–æ—Ä—Ñ–∏–Ω–≥ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π API

## üìã **–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û + Inngest –§—É–Ω–∫—Ü–∏—è –î–æ–±–∞–≤–ª–µ–Ω–∞**

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024-12-XX  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2024-12-XX

## üéØ **–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏**

–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/generate/morph-images` –¥–ª—è –º–æ—Ä—Ñ–∏–Ω–≥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–∏ Kling-v1.6, –≤–∫–ª—é—á–∞—è –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Inngest –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.

## ‚úÖ **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏**

### üîß **1. API –≠–Ω–¥–ø–æ–∏–Ω—Ç**
- ‚úÖ –°–æ–∑–¥–∞–Ω `POST /generate/morph-images` —ç–Ω–¥–ø–æ–∏–Ω—Ç
- ‚úÖ –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (9 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å multer –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ ZIP —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º –∫–ª–∏–µ–Ω—Ç—É

### üß¨ **2. Inngest –§—É–Ω–∫—Ü–∏—è (–ù–û–í–û–ï!)**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ Inngest —Ñ—É–Ω–∫—Ü–∏—è `morphImages` –≤ `src/inngest-functions/morphImages.ts`
- ‚úÖ –°–æ–±—ã—Ç–∏–µ: `'morph/images.requested'`
- ‚úÖ –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º `modelTrainingV2`/`neuroImageGeneration`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞, —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —Ä–µ—Ñ–∞–Ω–¥–æ–º
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —ç–∫—Å–ø–æ—Ä—Ç—ã `src/inngest-functions/index.ts`

### ‚öôÔ∏è **3. –°–∏—Å—Ç–µ–º–∞ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `ModeEnum.ImageMorphing` –≤ `src/interfaces/modes.ts`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ `src/price/helpers/modelsCost.ts`
- ‚úÖ –§–æ—Ä–º—É–ª–∞: $0.25 –±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å + $0.05 –∑–∞ –∫–∞–∂–¥–æ–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (—Å–≤—ã—à–µ 2)

### üì¶ **4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (6 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)**
- ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**: `src/interfaces/morphing.interface.ts` (296 —Å—Ç—Ä–æ–∫, 20+ —Ç–∏–ø–æ–≤)
- ‚úÖ **ZIP Processor**: `src/helpers/morphing/zipProcessor.ts` (311 —Å—Ç—Ä–æ–∫)
- ‚úÖ **Kling API Client**: `src/core/kling/index.ts` (408 —Å—Ç—Ä–æ–∫)
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å**: `src/services/generateMorphingVideo.ts` (418 —Å—Ç—Ä–æ–∫)
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `GenerationController.morphImages`
- ‚úÖ **–†–æ—É—Ç–∏–Ω–≥**: –¥–æ–±–∞–≤–ª–µ–Ω –≤ `GenerationRoute`

### üß™ **5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ **REST API —Ç–µ—Å—Ç**: `test-morphing-endpoint.js` (174 —Å—Ç—Ä–æ–∫–∏)
- ‚úÖ **Inngest —Ç–µ—Å—Ç**: `test-morphing-inngest.js` (200+ —Å—Ç—Ä–æ–∫, –ù–û–í–û–ï!)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö —Ä–µ–∂–∏–º–æ–≤: `node test-morphing-inngest.js [rest|inngest]`

### üìö **6. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: `MORPHING_API_GUIDE.md` (270+ —Å—Ç—Ä–æ–∫)
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (curl, JavaScript, Python)
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## üöÄ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ Inngest –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

### **–ü–∞—Ç—Ç–µ—Ä–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. **REST —ç–Ω–¥–ø–æ–∏–Ω—Ç** ‚Üí –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
2. **Inngest —Å–æ–±—ã—Ç–∏–µ** ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `'morph/images.requested'` —Å –¥–∞–Ω–Ω—ã–º–∏
3. **Inngest —Ñ—É–Ω–∫—Ü–∏—è** ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–ª–∞–Ω—Å–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)  
   - –ó–∞–ø—É—Å–∫ –º–æ—Ä—Ñ–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ `generateMorphingVideo`
   - –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ / —Ä–µ—Ñ–∞–Ω–¥ –ø—Ä–∏ –æ—à–∏–±–∫–µ
   - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

### **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `processBalanceOperation` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `updateUserBalance` —Å `PaymentType.MONEY_OUTCOME`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ModeEnum.ImageMorphing` –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å `getBotByName` –¥–ª—è Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `errorMessageAdmin` –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## üìä **–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- **üìÅ –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ/–∏–∑–º–µ–Ω–µ–Ω–æ:** 10
- **üìù –°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~2000+
- **üß™ –§—É–Ω–∫—Ü–∏–π:** 30+
- **üîß –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:** 20+
- **‚ö†Ô∏è –ù–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤:** 0 (–≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –≤ morphing-–∫–æ–¥–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!)

## üé¨ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**

### **–¢–∏–ø—ã –º–æ—Ä—Ñ–∏–Ω–≥–∞:**
- **Seamless** - –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏
- **Loop** - –∑–∞—Ü–∏–∫–ª–µ–Ω–Ω–æ–µ –≤–∏–¥–µ–æ (–ø–æ—Å–ª–µ–¥–Ω–∏–π ‚Üí –ø–µ—Ä–≤—ã–π –∫–∞–¥—Ä)

### **–§–æ—Ä–º–∞—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: JPG, JPEG, PNG, WebP
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ**: 2-100 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
- **–†–∞–∑–º–µ—Ä ZIP**: –¥–æ 50 –ú–ë

### **–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏:**
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è** ‚Üí 2. **–†–∞—Å–ø–∞–∫–æ–≤–∫–∞ ZIP** ‚Üí 3. **Kling –º–æ—Ä—Ñ–∏–Ω–≥** ‚Üí 4. **–ó–∞–≥—Ä—É–∑–∫–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Üí 5. **–î–æ—Å—Ç–∞–≤–∫–∞ –≤ Telegram**

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

### **REST API —Ç–µ—Å—Ç:**
```bash
export SECRET_API_KEY=your-secret-key
node test-morphing-endpoint.js
```

### **Inngest —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç:**  
```bash
# –¢–µ—Å—Ç —á–µ—Ä–µ–∑ Inngest —Å–æ–±—ã—Ç–∏–µ
node test-morphing-inngest.js inngest

# –¢–µ—Å—Ç —á–µ—Ä–µ–∑ REST API (–∑–∞–ø—É—Å–∫–∞–µ—Ç Inngest)
node test-morphing-inngest.js rest
```

## üõ†Ô∏è **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
KLING_API_KEY=your-kling-api-key
KLING_API_URL=https://api.kling.kuaishou.com/v1  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
SECRET_API_KEY=your-secret-key
```

## ‚ú® **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

### **–î–≤–æ–π–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- **–ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤**: REST API ‚Üí —Å–µ—Ä–≤–∏—Å `generateMorphingVideo` (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **Inngest –ø–æ—Ç–æ–∫**: REST API ‚Üí Inngest —Å–æ–±—ã—Ç–∏–µ ‚Üí Inngest —Ñ—É–Ω–∫—Ü–∏—è ‚Üí —Å–µ—Ä–≤–∏—Å (production)

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
- –ü–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ–∞–Ω–¥ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º:**
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö Inngest —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –∏ –ø–ª–∞—Ç–µ–∂–µ–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å (is_ru –ø–∞—Ä–∞–º–µ—Ç—Ä)

---

**üéâ –ó–ê–î–ê–ß–ê –ü–û–õ–ù–û–°–¢–¨–Æ –ó–ê–í–ï–†–®–ï–ù–ê! –ú–æ—Ä—Ñ–∏–Ω–≥ API –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–ª–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Inngest –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.**