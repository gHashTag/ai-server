# Instagram User Creation Function

## üïâÔ∏è –û–±–∑–æ—Ä

–§—É–Ω–∫—Ü–∏—è `createInstagramUser` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Instagram –≤ —Ç–∞–±–ª–∏—Ü–µ `instagram_similar_users` –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–∫—Ä–∞–ø–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ API. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç—ã.

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Inngest Function**: `createInstagramUser`

   - ID: `create-instagram-user`
   - Event: `instagram/create-user`
   - Concurrency: 5

2. **Database Class**: `InstagramDatabase.createSingleUser()`

   - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏

3. **Zod Schemas**: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   - `CreateInstagramUserEventSchema`
   - `CreateUserResultSchema`

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { triggerCreateInstagramUser } from '../src/inngest-functions/instagramScraper-v2'

const userData = {
  pk: '1234567890', // Instagram PK (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  username: 'my_username', // Username (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  full_name: 'My Full Name', // –ü–æ–ª–Ω–æ–µ –∏–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  is_private: false, // –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  is_verified: true, // –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  profile_pic_url: 'https://...', // URL –∞–≤–∞—Ç–∞—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  profile_chaining_secondary_label: 'Label', // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  social_context: 'Some context', // –ö–æ–Ω—Ç–µ–∫—Å—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  project_id: 1, // ID –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  requester_telegram_id: '123456', // ID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  metadata: {
    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    source: 'manual',
    created_by: 'admin',
  },
}

const result = await triggerCreateInstagramUser(userData)
console.log('Event ID:', result.eventId)
```

### 2. –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
node scripts/test-create-instagram-user.js

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
node scripts/test-create-instagram-user.js --multiple
```

## üîç –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (CreateInstagramUserEvent)

| –ü–æ–ª–µ                               | –¢–∏–ø     | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ---------------------------------- | ------- | ----------- | ---------------------------------- |
| `pk`                               | string  | ‚úÖ          | Instagram PK (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)       |
| `username`                         | string  | ‚úÖ          | Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è              |
| `full_name`                        | string  | ‚ùå          | –ü–æ–ª–Ω–æ–µ –∏–º—è                         |
| `is_private`                       | boolean | ‚ùå          | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (default: false) |
| `is_verified`                      | boolean | ‚ùå          | –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω (default: false)     |
| `profile_pic_url`                  | string  | ‚ùå          | URL –∞–≤–∞—Ç–∞—Ä–∞                        |
| `profile_chaining_secondary_label` | string  | ‚ùå          | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ            |
| `social_context`                   | string  | ‚ùå          | –ö–æ–Ω—Ç–µ–∫—Å—Ç                           |
| `project_id`                       | number  | ‚úÖ          | ID –ø—Ä–æ–µ–∫—Ç–∞ (–¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å)   |
| `requester_telegram_id`            | string  | ‚ùå          | ID –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–∞                      |
| `metadata`                         | object  | ‚ùå          | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ          |

### –†–µ–∑—É–ª—å—Ç–∞—Ç (CreateUserResult)

```typescript
{
  success: boolean,        // –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏
  created: boolean,        // –°–æ–∑–¥–∞–Ω –ª–∏ –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  alreadyExists: boolean,  // –°—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –ª–∏ —É–∂–µ
  user?: ValidatedInstagramUser, // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  error?: string          // –û—à–∏–±–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
}
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `instagram_similar_users`

–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–ª—è–º–∏:

- `search_username`: `manual_{username}` (–ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è)
- `user_pk`: Instagram PK
- `username`: Username –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `full_name`: –ü–æ–ª–Ω–æ–µ –∏–º—è
- `is_private`: –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- `is_verified`: –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- `profile_pic_url`: URL –∞–≤–∞—Ç–∞—Ä–∞
- `profile_url`: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (`https://instagram.com/{username}`)
- `profile_chaining_secondary_label`: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
- `social_context`: –ö–æ–Ω—Ç–µ–∫—Å—Ç
- `project_id`: ID –ø—Ä–æ–µ–∫—Ç–∞
- `scraped_at`: –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `created_at`: –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
- `updated_at`: –í—Ä–µ–º—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

–ó–∞–ø–∏—Å–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ `(user_pk, project_id)`.

## üîÑ Workflow

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (Zod)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î**
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è project_id** (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–æ–µ–∫—Ç)
4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
   - –í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
   - –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –ù–µ–≤–µ—Ä–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
2. **–ü—Ä–æ–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω**: project_id –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. **–î—É–±–ª–∏–∫–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
4. **–ë–î –æ—à–∏–±–∫–∞**: –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —ç–º–æ–¥–∑–∏:

- üöÄ –°—Ç–∞—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ùå –û—à–∏–±–∫–∏
- üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Inngest Dashboard

–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π:

- Local: http://localhost:8288
- Cloud: Inngest Dashboard

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
NEON_DATABASE_URL=postgresql://...  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–¢–∞–±–ª–∏—Ü–∞ `projects`** —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
2. **–¢–∞–±–ª–∏—Ü–∞ `instagram_similar_users`** (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. **Inngest server** –∑–∞–ø—É—â–µ–Ω
4. **–í–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
const testUser = {
  pk: Date.now().toString(),
  username: `test_user_${Date.now()}`,
  full_name: 'Test User',
  project_id: 1,
  requester_telegram_id: '144022504',
}

const result = await triggerCreateInstagramUser(testUser)
```

### –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
const verifiedUser = {
  pk: '9876543210',
  username: 'verified_user',
  full_name: 'Verified User',
  is_verified: true,
  profile_pic_url: 'https://example.com/avatar.jpg',
  project_id: 1,
}

const result = await triggerCreateInstagramUser(verifiedUser)
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
const privateUser = {
  pk: '1111111111',
  username: 'private_user',
  full_name: 'Private User',
  is_private: true,
  social_context: 'Private account user',
  project_id: 1,
}

const result = await triggerCreateInstagramUser(privateUser)
```

---

## üïâÔ∏è –ú—É–¥—Ä–æ—Å—Ç—å

_"–ö–∞–∫ —Å–µ–º—è, –ø–æ—Å–∞–∂–µ–Ω–Ω–æ–µ –≤ –ø–ª–æ–¥–æ—Ä–æ–¥–Ω—É—é –ø–æ—á–≤—É, –¥–∞—ë—Ç –ø–ª–æ–¥—ã, —Ç–∞–∫ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Ä–æ–∂–¥–∞—é—Ç –º—É–¥—Ä–æ—Å—Ç—å."_

–§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

- **–í–∞–ª–∏–¥–∞—Ü–∏—è** –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã)
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** TypeScript
