# üîß –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–ò –û–®–ò–ë–ö–ò –ü–£–°–¢–´–• –°–¢–†–û–ö INSTAGRAM API

**–î–∞—Ç–∞:** 18 –∏—é–ª—è 2025, 19:35 UTC  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ê –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –° –ü–£–°–¢–´–ú–ò –°–¢–†–û–ö–ê–ú–ò  
**–ü—Ä–æ–±–ª–µ–º–∞:** Instagram API –≤–æ–∑–≤—Ä–∞—â–∞–ª –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–∞–∫ –æ—à–∏–±–∫–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ

## üö® –ü–†–û–ë–õ–ï–ú–ê

### **–û—à–∏–±–∫–∞ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
```
Error: API call failed: API error: 
    at /Users/playra/ai-server/dist/inngest-functions/instagramScraper-v2.js:643:19
```

### **–ü—Ä–∏—á–∏–Ω–∞:**
Instagram API –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É** –≤ –ø–æ–ª–µ `data` –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "data": {
    "users": [...]
  }
}
```

**–û—à–∏–±–∫–∞ —Å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π:**
```json
{
  "status": "error", 
  "data": ""
}
```

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### **1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –≤ instagramScraperV2**
**–§–∞–π–ª:** `src/inngest-functions/instagramScraper-v2.ts`

**–ë—ã–ª–æ:**
```typescript
if (typeof validationResult.data!.data === 'string') {
  log.error(`‚ùå API returned error: ${validationResult.data!.data}`)
  return {
    success: false,
    error: `API error: ${validationResult.data!.data}`, // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
    users: [],
    total: 0,
  }
}
```

**–°—Ç–∞–ª–æ:**
```typescript
if (typeof validationResult.data!.data === 'string') {
  const apiError = validationResult.data!.data.trim()
  const errorMessage = apiError || 'Instagram API returned empty error response'
  log.error(`‚ùå API returned error: "${apiError}" (original response logged)`)
  log.error('Full API response:', JSON.stringify(response.data, null, 2))
  return {
    success: false,
    error: `API error: ${errorMessage}`,
    users: [],
    total: 0,
  }
}
```

### **2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∏–ª—Å–æ–≤**
**–§–∞–π–ª:** `src/inngest-functions/instagramScraper-v2.ts` (—Ñ—É–Ω–∫—Ü–∏—è getUserReels)

**–ë—ã–ª–æ:**
```typescript
if (typeof data === 'string') {
  log.error(`‚ùå API returned error: ${data}`)
  return {
    success: false,
    error: `API error: ${data}`, // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞!
```

**–°—Ç–∞–ª–æ:**
```typescript
if (typeof data === 'string') {
  const apiError = data.trim()
  const errorMessage = apiError || 'Instagram Reels API returned empty error response'
  log.error(`‚ùå Reels API returned error: "${apiError}" (original response logged)`)
  log.error('Full Reels API response:', JSON.stringify(response.data, null, 2))
  return {
    success: false,
    error: `API error: ${errorMessage}`,
```

### **3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Zod —Å—Ö–µ–º—ã**
**–§–∞–π–ª:** `src/core/instagram/schemas.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ:**
```typescript
data: z.union([
  z.object({
    id: z.union([z.string(), z.number()]).optional(),
    users: z.array(InstagramUserSchema),
  }),
  z.string().describe('API error response (can be empty)'), // –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
]),
```

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### **–£–ª—É—á—à–µ–Ω–∏—è –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏:**
1. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. **–ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:** –í–º–µ—Å—Ç–æ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ - –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
3. **–í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ:** –û—à–∏–±–∫–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

### **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**
1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –æ—à–∏–±–æ–∫ API
2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π Instagram API
3. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **Username:** yacheslav_nekludov
- **Telegram ID:** 289259562
- **Project ID:** 38
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ (max_users=1, scrape_reels=false)

### **–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —É–ª—É—á—à–µ–Ω–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ —Å –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏

## üìù –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### **–ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
1. **–ü—É—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** ‚Üí –û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏** ‚Üí –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ API
3. **–ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Üí –ï–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
1. **trim()** –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–∞—Ö –æ—à–∏–±–æ–∫
2. **JSON.stringify()** –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ API
3. **–û–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ fallback —Å–æ–æ–±—â–µ–Ω–∏—è** –¥–ª—è –ø—É—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Å –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏ Instagram API –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞:**

- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –ø—É—Å—Ç—ã—Ö –æ—à–∏–±–æ–∫
- ‚úÖ **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –û–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –≤—Å–µ—Ö Instagram API —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ª—é–±—ã–º —Ñ–æ—Ä–º–∞—Ç–∞–º –æ—à–∏–±–æ–∫ API

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–∞–º –æ—à–∏–±–æ–∫ Instagram API!**

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 19:35 UTC, 18 –∏—é–ª—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ò–°–ü–†–ê–í–õ–ï–ù–ê  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ 