# Instagram Reels API Fix - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

## üöÄ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Instagram Reels API, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –ø–∞–¥–µ–Ω–∏—é —Ñ—É–Ω–∫—Ü–∏–π —Å `ZodError`.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞

Instagram API –∏–Ω–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏ –≤ –ø–æ–ª–µ `data` –≤–º–µ—Å—Ç–æ –æ–±—ä–µ–∫—Ç–∞:

```json
{
  "status": "error",
  "message": "Some error",
  "data": "User not found or profile is private"
}
```

### –†–µ—à–µ–Ω–∏–µ

1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ union —Ç–∏–ø–æ–≤ (`object | string`)
2. –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ñ—É–Ω–∫—Ü–∏–π
3. –£–ª—É—á—à–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

## üìã –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. `analyzeCompetitorReels` - –ê–Ω–∞–ª–∏–∑ —Ä–∏–ª—Å–æ–≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

```typescript
// –°–æ–±—ã—Ç–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
await inngest.send({
  name: 'instagram/analyze-reels',
  data: {
    username: 'alexyanovsky',
    max_reels: 10,
    days_back: 14,
    project_id: 1,
    requester_telegram_id: '144022504',
  },
})
```

### 2. `instagramScraperV2` - –°–∫—Ä–∞–ø–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∏–ª—Å–∞–º–∏

```typescript
// –°–æ–±—ã—Ç–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
await inngest.send({
  name: 'instagram/scrape-similar-users',
  data: {
    username_or_id: 'alexyanovsky',
    project_id: 1,
    max_users: 5,
    max_reels_per_user: 3,
    scrape_reels: true,
    requester_telegram_id: '144022504',
  },
})
```

### 3. `extractTopContent` - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–æ–ø–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```typescript
// –°–æ–±—ã—Ç–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
await inngest.send({
  name: 'instagram/extract-top-content',
  data: {
    username: 'alexyanovsky',
    days_back: 14,
    limit: 10,
    project_id: 1,
    requester_telegram_id: '144022504',
  },
})
```

### 4. `generateContentScripts` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```typescript
// –°–æ–±—ã—Ç–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
await inngest.send({
  name: 'instagram/generate-content-scripts',
  data: {
    reel_id: 'test_reel_id',
    ig_reel_url: 'https://instagram.com/p/DHp5jLHt8v6/',
    project_id: 1,
    requester_telegram_id: '144022504',
  },
})
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
bun run src/server.ts

# Inngest Dev Server
npm run dev:inngest
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ (5 —Ñ—É–Ω–∫—Ü–∏–π)
bun run test-events/test-reels-fix.ts

# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç (1 —Ñ—É–Ω–∫—Ü–∏—è)
bun run test-events/quick-test.ts
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Inngest Dashboard:** http://localhost:8288
- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä:** http://localhost:4000
- **–õ–æ–≥–∏:** –°–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä—ã

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

- ‚úÖ –§—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏ API
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîç –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—Å–µ –µ—â–µ –ø–∞–¥–∞—é—Ç:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`RAPIDAPI_INSTAGRAM_KEY`, `NEON_DATABASE_URL`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Inngest Dashboard
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Instagram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–¢–µ–ø–µ—Ä—å —Ñ—É–Ω–∫—Ü–∏–∏ Instagram Reels API –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram –±–æ—Ç–æ–º —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é.
