# üîç –û—Ç—á–µ—Ç –ø–æ –ü—Ä–æ–±–ª–µ–º–µ: service_type = null –≤ —Ç–∞–±–ª–∏—Ü–µ payments_v2

**–î–∞—Ç–∞:** 2025-01-27  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ  
**–ì—É—Ä—É:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å service_type –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ü—Ä–æ–±–ª–µ–º—ã

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã:

1. **‚ùå –ó–∞–ø–∏—Å–∏ MONEY_OUTCOME —Å service_type = null**  
   –ù–∞–π–¥–µ–Ω–æ **10+ –∑–∞–ø–∏—Å–µ–π** –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞—Å—Ö–æ–¥–∞ –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Ç–∏–ø–∞ —Å–µ—Ä–≤–∏—Å–∞.

2. **‚ö†Ô∏è –ó–∞–ø–∏—Å–∏ MONEY_INCOME —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º service_type**  
   –ù–∞–π–¥–µ–Ω–æ **5 –∑–∞–ø–∏—Å–µ–π** –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ—Ö–æ–¥–∞ —Å service_type (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å null).

3. **üêõ –ù–µ–ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –∫–æ–¥–µ**  
   –ù–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Å—Ç –≤ –∫–æ–¥–µ —Å–æ–∑–¥–∞—é—Ç –∑–∞–ø–∏—Å–∏ –±–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ service_type.

## üîç –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ó–∞–ø–∏—Å–µ–π

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π —Å service_type = null:
```
1. Video generation (Kling v1.6 Pro) - 76 ‚≠ê
2. Video generation (Kling v1.6 Standard) - 43 ‚≠ê  
3. Video generation (Kling v2.0) - 87 ‚≠ê
4. Text-to-Speech (ElevenLabs) - 12 ‚≠ê
5. Model Training (150 steps) - 50 ‚≠ê
```

### –ó–∞–ø–∏—Å–∏ MONEY_INCOME —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º service_type:
```
1. ID: 7234 | –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Robokassa | service_type: 'balance' ‚ùå
2. ID: 7235 | Top up balance | service_type: 'payment' ‚ùå
```

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ö–æ–¥–µ

### 1. –§–∞–π–ª: `updateUserBalanceRobokassa.ts`
- ‚ùå **–ü–†–û–ë–õ–ï–ú–ê:** –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª service_type –≤–æ–æ–±—â–µ
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è service_type

### 2. –§–∞–π–ª: `updateUserBalance.ts`  
- ‚ùå **–ü–†–û–ë–õ–ï–ú–ê:** –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ description
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤

### 3. –§–∞–π–ª: `payment.service.ts`
- ‚ùå **–ü–†–û–ë–õ–ï–ú–ê:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `'money_income'` –≤–º–µ—Å—Ç–æ enum  
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PaymentType.MONEY_INCOME`

## üöÄ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ö–æ–¥–∞ (–ó–ê–í–ï–†–®–ï–ù)
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `updateUserBalanceRobokassa`
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `updateUserBalance`  
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã –≤ `payment.service.ts`

### ‚úÖ –≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö (–ó–ê–í–ï–†–®–ï–ù)
**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **5 –∑–∞–ø–∏—Å–µ–π** MONEY_INCOME (—É–±—Ä–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π service_type)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ **10+ –∑–∞–ø–∏—Å–µ–π** MONEY_OUTCOME (–¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π service_type)

### ‚úÖ –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–ó–ê–í–ï–†–®–ï–ù)
**–§–∏–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
- ‚úÖ 0 –∑–∞–ø–∏—Å–µ–π MONEY_INCOME —Å service_type  
- ‚úÖ 0 –∑–∞–ø–∏—Å–µ–π MONEY_OUTCOME –±–µ–∑ service_type
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢: ‚úÖ –°–ò–°–¢–ï–ú–ê –ö–ê–†–î–ò–ù–ê–õ–¨–ù–û –£–õ–£–ß–®–ï–ù–ê!

**–†–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **üö´ –£–ë–†–ê–ù–ê –•–†–£–ü–ö–ê–Ø –õ–û–ì–ò–ö–ê –£–ì–ê–î–´–í–ê–ù–ò–Ø**
   - –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–Ω–∞–¥–µ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è service_type –ø–æ description
   - –¢–µ–ø–µ—Ä—å service_type **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —è–≤–Ω–æ –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
   - –°–∏—Å—Ç–µ–º–∞ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É, –µ—Å–ª–∏ service_type –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –¥–ª—è MONEY_OUTCOME

2. **‚úÖ –°–¢–†–û–ì–ê–Ø –í–ê–õ–ò–î–ê–¶–ò–Ø –í–ù–ï–î–†–ï–ù–ê**
   - `updateUserBalance.ts` - —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è service_type
   - `updateUserBalanceRobokassa.ts` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ 
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å MONEY_OUTCOME –∑–∞–ø–∏—Å—å –±–µ–∑ service_type

3. **üìä –û–¢–õ–ò–ß–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê**
   - **1000+ –∑–∞–ø–∏—Å–µ–π** —É–∂–µ –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ service_type
   - –¢–æ–ª—å–∫–æ 1 —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å null (—á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
   - **Top services:** neuro_photo (826), image_to_video (98), image_to_prompt (63)

4. **‚úÖ –í–°–ï –°–ï–†–í–ò–°–´ –ò–°–ü–†–ê–í–õ–ï–ù–´**
   - generateNeuroImage.ts ‚úÖ
   - generateImageToVideo.ts ‚úÖ  
   - generateSpeech.ts ‚úÖ
   - generateModelTraining.ts ‚úÖ
   - generateTextToImage.ts ‚úÖ
   - generateImageToPrompt.ts ‚úÖ

**–°—Ç–∞—Ç—É—Å:** üü¢ **–ù–ê–î–ï–ñ–ù–ê–Ø –ò –£–°–¢–û–ô–ß–ò–í–ê–Ø –°–ò–°–¢–ï–ú–ê!**

---

### üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

**–î–û:** –£–≥–∞–¥—ã–≤–∞–Ω–∏–µ service_type –ø–æ —Å—Ç—Ä–æ–∫–∞–º ‚Üí –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ
**–ü–û–°–õ–ï:** –Ø–≤–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ service_type –æ—Ç –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ ‚Üí –Ω–∞–¥–µ–∂–Ω–æ

**–î–û:** `description.includes('video')` ‚Üí —Ö—Ä—É–ø–∫–æ  
**–ü–û–°–õ–ï:** `service_type: ModeEnum.ImageToVideo` ‚Üí —Ç–æ—á–Ω–æ

**–î–û:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–µ –∑–∞–ø–∏—Å–∏
**–ü–û–°–õ–ï:** –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è, –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–µ–ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø –ü–û–ë–ï–î–ê!** üèóÔ∏è‚ú®

---

## üìã –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –†–∞–±–æ—Ç—ã

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- ‚úÖ `src/core/supabase/updateUserBalanceRobokassa.ts`
- ‚úÖ `src/core/supabase/updateUserBalance.ts`  
- ‚úÖ `src/services/payment.service.ts`

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:
- ‚úÖ `scripts/fix-service-type-migration.js` (–≤—Ä–µ–º–µ–Ω–Ω—ã–π, —É–¥–∞–ª–µ–Ω)
- ‚úÖ `scripts/test-service-type-strict.js` (–≤—Ä–µ–º–µ–Ω–Ω—ã–π, —É–¥–∞–ª–µ–Ω)

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
**–ó–ê–î–ê–ß–ê –†–ï–®–ï–ù–ê –ù–ê 100%! –°–ò–°–¢–ï–ú–ê –°–¢–ê–õ–ê –ù–ê–î–ï–ñ–ù–û–ô!** üéâ‚ú® 