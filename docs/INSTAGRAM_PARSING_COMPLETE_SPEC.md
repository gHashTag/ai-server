# üé¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ Instagram –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∏–ª—Å–æ–≤

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **Instagram Apify Scraper** (`instagramApifyScraper.ts`)

   - ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∏–ª—Å–æ–≤ —á–µ—Ä–µ–∑ Apify API
   - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL `instagram_apify_reels`
   - ‚úÖ –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è: 0.144 ‚≠ê –∑–∞ —Ä–∏–ª—Å
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–¥–º–∏–Ω–æ–≤
   - ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

2. **Competitor Auto Parser** (`competitorAutoParser.ts`)

   - ‚úÖ Cron –∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (08:00 UTC)
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
   - ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

3. **Competitor Delivery** (`competitorDelivery.ts`)

   - ‚úÖ –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º
   - ‚úÖ –§–æ—Ä–º–∞—Ç—ã: –¥–∞–π–¥–∂–µ—Å—Ç, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ä–∏–ª—Å—ã, –∞—Ä—Ö–∏–≤
   - ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º –∏ –≤–æ–∑—Ä–∞—Å—Ç—É

4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - ‚úÖ `instagram_apify_reels` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∏–ª—Å–æ–≤
   - ‚úÖ `competitor_subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - ‚úÖ `competitor_delivery_history` - –∏—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∞–≤–æ–∫

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ `instagramApifyScraper` –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∏–ª—Å–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –≤ –∫–æ–Ω—Ü–µ `instagramApifyScraper` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ `competitorDelivery`.

### 2. **–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤—ã—Ö —Ä–∏–ª—Å–æ–≤ –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º**

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ**: –†–∞–∑ –≤ 24 —á–∞—Å–∞ –∫–∞–∂–¥—ã–π –ø–æ–¥–ø–∏—Å—á–∏–∫ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Ä–∏–ª—Å—ã –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω –ø–æ–¥–ø–∏—Å–∞–Ω.

**–¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã**:

```
08:00 UTC: competitorAutoParser –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí –ø–∞—Ä—Å–∏—Ç –≤—Å–µ—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
08:15 UTC: –ö–∞–∂–¥—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å competitorDelivery
08:30 UTC: –í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç –Ω–æ–≤—ã–µ —Ä–∏–ª—Å—ã
```

### 3. **–ù–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏ —Å–≤—è–∑–∏**

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Inngest –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `instagramApifyScraper.ts`

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏:

```typescript
// –í –∫–æ–Ω—Ü–µ instagramApifyScraper –ø–µ—Ä–µ–¥ return result
if (
  processedReels.length > 0 &&
  validatedData.requester_telegram_id === 'auto-system'
) {
  await step.run('trigger-delivery', async () => {
    try {
      // –ó–∞–ø—É—Å–∫–∞–µ–º –¥–æ—Å—Ç–∞–≤–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞
      const deliveryResult = await inngest.send({
        name: 'competitor/delivery-reels',
        data: {
          competitor_username: validatedData.username_or_hashtag,
          project_id: validatedData.project_id,
          triggered_by: 'auto-parser',
        },
      })

      log.info('üì¨ –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞:', deliveryResult.ids[0])
    } catch (error: any) {
      log.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:', error.message)
    }
  })
}
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `systemMonitor.ts`:

```typescript
export const systemMonitor = inngest.createFunction(
  {
    id: 'system-monitor',
    name: 'üìä System Monitor',
  },
  { cron: '0 9 * * *' }, // –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00 UTC (—á–µ—Ä–µ–∑ —á–∞—Å –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞)
  async ({ event, step }) => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å–µ –ø–∞—Ä—Å–∏–Ω–≥–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å
    const yesterday = new Date()
    yesterday.setHours(yesterday.getHours() - 24)

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Å–∏–Ω–≥–æ–≤
    const parsedToday = await step.run('check-parsing', async () => {
      const client = await dbPool.connect()
      try {
        const result = await client.query(
          `
          SELECT COUNT(*) as count 
          FROM instagram_apify_reels 
          WHERE scraped_at >= $1
        `,
          [yesterday]
        )
        return result.rows[0].count
      } finally {
        client.release()
      }
    })

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç–∞–≤–æ–∫
    const deliveriesCount = await step.run('check-deliveries', async () => {
      const client = await dbPool.connect()
      try {
        const result = await client.query(
          `
          SELECT COUNT(*) as count 
          FROM competitor_delivery_history 
          WHERE created_at >= $1
        `,
          [yesterday]
        )
        return result.rows[0].count
      } finally {
        client.release()
      }
    })

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –∞–¥–º–∏–Ω—É
    await step.run('send-daily-report', async () => {
      if (process.env.ADMIN_CHAT_ID) {
        const { getBotByName } = await import('@/core/bot')
        const { bot } = getBotByName('neuro_blogger_bot')

        const report = `
üìä –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –æ—Ç—á—ë—Ç —Å–∏—Å—Ç–µ–º—ã –ø–∞—Ä—Å–∏–Ω–≥–∞

üé¨ –†–∏–ª—Å–æ–≤ —Å–ø–∞—Ä—à–µ–Ω–æ: ${parsedToday}
üì¨ –î–æ—Å—Ç–∞–≤–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${deliveriesCount}
‚è∞ –ó–∞ –ø–µ—Ä–∏–æ–¥: –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞

${parsedToday > 0 ? '‚úÖ' : '‚ùå'} –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
${deliveriesCount > 0 ? '‚úÖ' : '‚ùå'} –î–æ—Å—Ç–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

${
  parsedToday === 0 || deliveriesCount === 0
    ? '‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã!'
    : 'üéØ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ'
}
        `

        await bot.telegram.sendMessage(process.env.ADMIN_CHAT_ID, report)
      }
    })

    return {
      success: true,
      parsed_reels: parsedToday,
      deliveries_count: deliveriesCount,
      status:
        parsedToday > 0 && deliveriesCount > 0 ? 'healthy' : 'needs_attention',
    }
  }
)
```

### –®–∞–≥ 3: –£–ª—É—á—à–µ–Ω–∏–µ `competitorDelivery.ts`

–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª—É—á–∞—è –∫–æ–≥–¥–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ä–∏–ª—Å–æ–≤:

```typescript
// –í competitorDelivery.ts - —É–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É "–Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ä–∏–ª—Å–æ–≤"
if (reelsData.length === 0) {
  log.info('üì≠ –ù–µ—Ç –Ω–æ–≤—ã—Ö —Ä–∏–ª—Å–æ–≤ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏')

  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  for (const subscriber of subscribers) {
    try {
      if (subscriber.notify_when_no_reels !== false) {
        // –ï—Å–ª–∏ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ
        const { getBotByName } = await import('@/core/bot')
        const { bot } = getBotByName(subscriber.bot_name)

        await bot.api.sendMessage(
          subscriber.user_telegram_id,
          `üì≠ @${competitor_username}: –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Ä–∏–ª—Å–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞\n\n` +
            `üí° –í–æ–∑–º–æ–∂–Ω–æ, –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞–ª –∫–æ–Ω—Ç–µ–Ω—Ç –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–µ`
        )
      }
    } catch (error: any) {
      log.error(
        `‚ùå –û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${subscriber.user_telegram_id}:`,
        error.message
      )
    }
  }

  return { success: true, message: 'No new reels to deliver' }
}
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–æ—Å—Ç–∞–≤–∫–∏:

```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã competitor_subscriptions
ALTER TABLE competitor_subscriptions
ADD COLUMN IF NOT EXISTS delivery_format VARCHAR(20) DEFAULT 'digest',
ADD COLUMN IF NOT EXISTS notify_when_no_reels BOOLEAN DEFAULT true,
ADD COLUMN IF NOT EXISTS preferred_delivery_time TIME DEFAULT '09:00:00',
ADD COLUMN IF NOT EXISTS timezone VARCHAR(50) DEFAULT 'UTC';

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã competitor_delivery_history
ALTER TABLE competitor_delivery_history
ADD COLUMN IF NOT EXISTS delivery_method VARCHAR(20) DEFAULT 'auto',
ADD COLUMN IF NOT EXISTS delivery_trigger VARCHAR(50) DEFAULT 'scheduled';
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã

–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `healthCheck.ts`:

```typescript
export const healthCheck = inngest.createFunction(
  {
    id: 'health-check',
    name: 'üîç Health Check',
  },
  { cron: '*/30 * * * *' }, // –ö–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
  async ({ event, step }) => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Inngest —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
    const checks = await step.run('run-health-checks', async () => {
      const results = {
        database: false,
        inngest: false,
        apify: false,
        telegram: false,
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      try {
        const client = await dbPool.connect()
        await client.query('SELECT 1')
        client.release()
        results.database = true
      } catch (error) {
        results.database = false
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ Inngest (–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ)
      try {
        await inngest.send({
          name: 'system/health-ping',
          data: { timestamp: Date.now() },
        })
        results.inngest = true
      } catch (error) {
        results.inngest = false
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ Apify API
      try {
        const response = await fetch('https://api.apify.com/v2/acts', {
          headers: { Authorization: `Bearer ${process.env.APIFY_TOKEN}` },
        })
        results.apify = response.ok
      } catch (error) {
        results.apify = false
      }

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram API
      try {
        const { getBotByName } = await import('@/core/bot')
        const { bot } = getBotByName('neuro_blogger_bot')
        await bot.telegram.getMe()
        results.telegram = true
      } catch (error) {
        results.telegram = false
      }

      return results
    })

    // –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∞–ª–µ—Ä—Ç
    const failedServices = Object.entries(checks)
      .filter(([_, status]) => !status)
      .map(([service, _]) => service)

    if (failedServices.length > 0) {
      await step.run('send-alert', async () => {
        if (process.env.ADMIN_CHAT_ID) {
          const { getBotByName } = await import('@/core/bot')
          const { bot } = getBotByName('neuro_blogger_bot')

          await bot.telegram.sendMessage(
            process.env.ADMIN_CHAT_ID,
            `üö® –ê–õ–ï–†–¢: –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏—Å—Ç–µ–º–æ–π\n\n` +
              `‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–µ—Ä–≤–∏—Å—ã:\n${failedServices
                .map(s => `‚Ä¢ ${s}`)
                .join('\n')}\n\n` +
              `‚è∞ ${new Date().toISOString()}`
          )
        }
      })
    }

    return {
      success: true,
      health_status: checks,
      failed_services: failedServices,
      overall_health: failedServices.length === 0 ? 'healthy' : 'degraded',
    }
  }
)
```

## üìã –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ `instagramApifyScraper`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤—è–∑–∫—É –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É cron-–∑–∞–¥–∞—á –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ

### –≠—Ç–∞–ø 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∑–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã

- [ ] –°–æ–∑–¥–∞—Ç—å `systemMonitor.ts`
- [ ] –°–æ–∑–¥–∞—Ç—å `healthCheck.ts`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –∞–¥–º–∏–Ω–∞–º

### –≠—Ç–∞–ø 3: –£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞

- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≤ –ø–æ–¥–ø–∏—Å–∫–∏
- [ ] –£–ª—É—á—à–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –≠—Ç–∞–ø 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

## üí∞ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

### –¢–µ–∫—É—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã:

- **Apify API**: $2.30 –∑–∞ 1000 —Ä–∏–ª—Å–æ–≤
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è**: 0.144 ‚≠ê –∑–∞ —Ä–∏–ª—Å
- **–°—Ä–µ–¥–Ω–∏–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç**: 10-20 —Ä–∏–ª—Å–æ–≤ –≤ –¥–µ–Ω—å
- **–°—Ä–µ–¥–Ω—è—è –ø–æ–¥–ø–∏—Å–∫–∞**: 3-5 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ:

- **100 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤**
- **300 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤**
- **~3000 —Ä–∏–ª—Å–æ–≤ –≤ –¥–µ–Ω—å** (300 –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ √ó 10 —Ä–∏–ª—Å–æ–≤)
- **–°—Ç–æ–∏–º–æ—Å—Ç—å**: ~$7 –≤ –¥–µ–Ω—å –Ω–∞ Apify
- **–î–æ—Ö–æ–¥**: ~430 ‚≠ê –≤ –¥–µ–Ω—å (3000 √ó 0.144)

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Inngest
INNGEST_BASE_URL=http://localhost:8288
INNGEST_SIGNING_KEY=your-signing-key
INNGEST_EVENT_KEY=your-event-key
INNGEST_DEV=1

# Apify
APIFY_TOKEN=your-apify-token

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
NEON_DATABASE_URL=postgresql://user:pass@host/db

# Telegram
BOT_TOKEN_1=your-bot-token
ADMIN_CHAT_ID=144022504

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
HEALTH_CHECK_ENABLED=true
ALERTS_ENABLED=true
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:

```javascript
// test-full-cycle.js
async function testFullCycle() {
  console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏')

  // 1. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É
  const subscription = await createTestSubscription('theaisurfer')

  // 2. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–∞—Ä—Å–∏–Ω–≥
  const parseResult = await triggerApifyInstagramScraping({
    username_or_hashtag: 'theaisurfer',
    project_id: 999,
    source_type: 'competitor',
    max_reels: 5,
    requester_telegram_id: 'auto-system',
    bot_name: 'neuro_blogger_bot',
  })

  console.log('‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω:', parseResult.eventId)

  // 3. –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∞–≤–∫—É
  setTimeout(async () => {
    const deliveries = await checkDeliveryHistory(subscription.id)
    console.log('üì¨ –î–æ—Å—Ç–∞–≤–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:', deliveries.length)
  }, 300000) // 5 –º–∏–Ω—É—Ç
}
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Å–∏–Ω–≥–æ–≤ –≤ –¥–µ–Ω—å**
2. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∏–ª—Å–æ–≤**
3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –¥–æ—Å—Ç–∞–≤–æ–∫**
4. **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π**
5. **–û—à–∏–±–∫–∏ –∏ –∏—Ö —Ç–∏–ø—ã**
6. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

### –î–∞—à–±–æ—Ä–¥ –º–µ—Ç—Ä–∏–∫:

```sql
-- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT
  DATE(scraped_at) as date,
  COUNT(*) as reels_parsed,
  COUNT(DISTINCT owner_username) as unique_competitors
FROM instagram_apify_reels
WHERE scraped_at >= NOW() - INTERVAL '7 days'
GROUP BY DATE(scraped_at)
ORDER BY date DESC;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–æ–∫
SELECT
  delivery_status,
  COUNT(*) as count,
  AVG(reels_count) as avg_reels_delivered
FROM competitor_delivery_history
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY delivery_status;
```

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### –°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–π –∫–æ–≥–¥–∞:

- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7
- [ ] –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
- [ ] –í—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Ä–∏–ª—Å—ã –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- [ ] –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- [ ] –≠–∫–æ–Ω–æ–º–∏–∫–∞ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∞ (–¥–æ—Ö–æ–¥—ã > —Ä–∞—Å—Ö–æ–¥—ã)

---

## üöÄ –ü–µ—Ä–µ–¥–∞—á–∞ –∑–∞–¥–∞—á–∏ –∞–≥–µ–Ω—Ç—É

–î–∞–Ω–Ω–æ–µ –¢–ó —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ—Ç–∞–ª–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏ Instagram —Ä–∏–ª—Å–æ–≤.

**–û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ü–∏–∫–ª –æ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∏–ª—Å–æ–≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π - —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º —Ä–µ–∂–∏–º–µ –∏ –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –¥–æ—Ö–æ–¥.
