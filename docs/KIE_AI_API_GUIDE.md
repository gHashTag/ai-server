# üöÄ Kie.ai API Integration Guide

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Kie.ai –≤ –Ω–∞—à–µ–º AI-—Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º—É–∑—ã–∫–∏.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```bash
KIE_AI_API_KEY=your_kie_ai_api_key_here
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Kie.ai](https://kie.ai)
2. –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å (–º–∏–Ω–∏–º—É–º $5)
3. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á –≤ —Ä–∞–∑–¥–µ–ª–µ API

## üé¨ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | ID | –û–ø–∏—Å–∞–Ω–∏–µ | –¶–µ–Ω–∞/—Å–µ–∫ | –≠–∫–æ–Ω–æ–º–∏—è vs Google |
|--------|----|---------|---------:|-------------------:|
| Veo 3 Fast | `veo-3-fast` | –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¢–û–õ–¨–ö–û 8 —Å–µ–∫ | $0.05 | 83% |
| Veo 3 Quality | `veo-3` | –ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ | $0.25 | 37% |
| Runway Aleph | `runway-aleph` | –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | $0.30 | 25% |

### API Endpoint

```typescript
POST /api/video/generate
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

```typescript
interface VideoGenerationRequest {
  model: 'veo-3-fast' | 'veo-3' | 'runway-aleph'
  prompt: string
  duration: number // 8 —Å–µ–∫—É–Ω–¥ –¥–ª—è veo-3-fast, 2-10 –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
  aspectRatio?: '16:9' | '9:16' | '1:1'
  imageUrl?: string // –¥–ª—è image-to-video
  userId?: string
  projectId?: number
}
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

‚ö†Ô∏è **–í–ê–ñ–ù–û: Veo 3 Fast –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¢–û–õ–¨–ö–û 8-—Å–µ–∫—É–Ω–¥–Ω—ã–µ –≤–∏–¥–µ–æ!** –õ—é–±–æ–π –¥—Ä—É–≥–æ–π duration –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ 8.

```bash
curl -X POST http://localhost:4000/api/video/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "model": "veo-3-fast",
    "prompt": "Beautiful sunset over mountains, cinematic",
    "duration": 8,
    "aspectRatio": "16:9"
  }'
```

### –û—Ç–≤–µ—Ç

```typescript
interface VideoGenerationResponse {
  success: boolean
  data?: {
    videoUrl: string
    duration: number
    taskId?: string
  }
  cost: {
    usd: number
    stars: number
  }
  provider: 'Kie.ai'
  model: string
  processingTime?: number
  error?: string
}
```

## üñºÔ∏è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | ID | –û–ø–∏—Å–∞–Ω–∏–µ | –¶–µ–Ω–∞ |
|--------|----|---------|---------:|
| GPT-4o Image | `gpt-4o-image` | –¢–æ—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞ | $0.10 |
| Midjourney v7 | `midjourney-v7` | –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ | $0.15 |
| FLUX.1 Kontext | `flux-1-kontext` | –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ | $0.08 |

### API Endpoint

```typescript
POST /api/image/generate
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

```typescript
interface ImageGenerationRequest {
  model: 'gpt-4o-image' | 'midjourney-v7' | 'flux-1-kontext'
  prompt: string
  width?: number
  height?: number
  numImages?: number // 1-4
  style?: string
  imageUrl?: string // –¥–ª—è img2img
  userId?: string
  projectId?: number
}
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X POST http://localhost:4000/api/image/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "model": "midjourney-v7",
    "prompt": "Cyberpunk city at night, neon lights, 4k",
    "width": 1024,
    "height": 1024
  }'
```

## üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | ID | –û–ø–∏—Å–∞–Ω–∏–µ | –¶–µ–Ω–∞ | –ú–∞–∫—Å. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
|--------|----|---------|---------:|-------------------:|
| Suno v3.5 | `suno-v3.5` | –ë–∞–∑–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è | $0.20 | 3 –º–∏–Ω |
| Suno v4 | `suno-v4` | –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ | $0.25 | 4 –º–∏–Ω |
| Suno v4.5 | `suno-v4.5` | –£–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã | $0.30 | 5 –º–∏–Ω |
| Suno v4.5+ | `suno-v4.5-plus` | –ü—Ä–µ–º–∏—É–º –∫–∞—á–µ—Å—Ç–≤–æ | $0.40 | 8 –º–∏–Ω |

### API Endpoint

```typescript
POST /api/music/generate
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞

```typescript
interface MusicGenerationRequest {
  model: 'suno-v3.5' | 'suno-v4' | 'suno-v4.5' | 'suno-v4.5-plus'
  prompt: string
  duration?: number // 30-480 —Å–µ–∫—É–Ω–¥
  genre?: string
  lyrics?: string
  instrumental?: boolean
  userId?: string
  projectId?: number
}
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X POST http://localhost:4000/api/music/generate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "model": "suno-v4.5",
    "prompt": "Epic orchestral music, cinematic, adventure",
    "duration": 120,
    "genre": "orchestral",
    "instrumental": true
  }'
```

## üí∞ –°–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ —Ü–µ–Ω—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö:
- `src/config/models.config.ts` - –≤–∏–¥–µ–æ –º–æ–¥–µ–ª–∏
- `src/config/music.config.ts` - –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏  
- `src/helpers/IMAGES_MODELS.ts` - –º–æ–¥–µ–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `src/config/pricing.config.ts` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è

### –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏

```typescript
import { PricingCalculator } from '@/config/pricing.config'

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è USD –≤ –∑–≤–µ–∑–¥—ã —Å –Ω–∞—Ü–µ–Ω–∫–æ–π
const stars = PricingCalculator.usdToStars(0.25) // $0.25 -> –∑–≤–µ–∑–¥—ã

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–≤–µ–∑–¥ –≤ —Ä—É–±–ª–∏
const rubles = PricingCalculator.starsToRub(100) // 100 –∑–≤–µ–∑–¥ -> —Ä—É–±–ª–∏

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è USD –≤ —Ä—É–±–ª–∏
const rubles2 = PricingCalculator.usdToRub(5.0) // $5 -> —Ä—É–±–ª–∏
```

### –ù–∞—Ü–µ–Ω–∫–∏

- **–ë–∞–∑–æ–≤–∞—è –Ω–∞—Ü–µ–Ω–∫–∞**: 150% (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 1.5)
- **–ö—É—Ä—Å —Ä—É–±–ª—è**: –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç —á–µ—Ä–µ–∑ Bybit API
- **–†–µ–∑–µ—Ä–≤–Ω—ã–π –∫—É—Ä—Å**: 85‚ÇΩ/$1

## üîÑ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { providerManager } from '@/services/UniversalProviderManager'

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –º–æ–¥–µ–ª–∏
const result = await providerManager.generateVideo('veo-3-fast', {
  prompt: 'Beautiful landscape',
  duration: 5
})

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏
const models = providerManager.getAllModels()

// –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏
const provider = providerManager.getProviderForModel('veo-3-fast')
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
UniversalProviderManager
‚îú‚îÄ‚îÄ KieAiProvider (–≤–∏–¥–µ–æ, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –º—É–∑—ã–∫–∞)
‚îú‚îÄ‚îÄ ReplicateProvider (—Ä–µ–∑–µ—Ä–≤)
‚îú‚îÄ‚îÄ VertexAiProvider (—Ä–µ–∑–µ—Ä–≤)
‚îî‚îÄ‚îÄ OpenAIProvider (—Ä–µ–∑–µ—Ä–≤)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–∫—Ä–∏–ø—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∞–ª–∞–Ω—Å–∞ –∏ —Ü–µ–Ω–∞–º–∏
node scripts/test-kieai-simple.js

# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Ü–µ–Ω –∏ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–æ–º –ø—Ä–∏–±—ã–ª–∏
node scripts/test-kieai-full.js

# –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏
node scripts/show-all-kieai-models.js

# –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ
node scripts/test-kieai-video.js
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞

```typescript
import { KieAiProvider } from '@/services/video-providers/KieAiProvider'

const provider = new KieAiProvider()
const balance = await provider.getAccountBalance()
console.log(`Credits: ${balance.credits}`)
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| 401 | –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å KIE_AI_API_KEY |
| 429 | –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ | –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å –ø–ª–∞–Ω |
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ |
| 402 | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ | –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å |

### Retry –ª–æ–≥–∏–∫–∞

API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö:
- –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1—Å, 2—Å, 4—Å
- –¢–∞–π–º-–∞—É—Ç: 5 –º–∏–Ω—É—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ Winston:

```typescript
import { logger } from '@/utils/logger'

logger.info({
  message: 'üé¨ Video generation started',
  model: 'veo-3-fast',
  duration: 5,
  cost: { usd: 0.25, stars: 25 }
})
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—à–∏–±–∫–∏ –∏ –∏—Ö —Ç–∏–ø—ã

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### API –∫–ª—é—á–∏

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ –∫–ª—é—á–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –†–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ

### –í–∞–ª–∏–¥–∞—Ü–∏—è

–í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑:
- class-validator –¥–ª—è DTO
- Joi/Zod —Å—Ö–µ–º—ã –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

## üöÄ Deployment

### Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
# .env.production
KIE_AI_API_KEY=prod_key_here
NODE_ENV=production
LOG_LEVEL=info
```

### Health Check

```bash
curl http://localhost:4000/health
```

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Kie.ai API
- –ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞
- –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### Rate Limiting

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É –Ω–∞ IP
- 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- CDN –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- In-memory –∫—ç—à –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

## üõ†Ô∏è Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **"KIE_AI_API_KEY is required"**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–¥–∞–Ω–∞ –≤ .env

2. **"Insufficient credits"**
   - –ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –Ω–∞ Kie.ai

3. **"Video generation timeout"**
   - –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ fast –º–æ–¥–µ–ª—å

4. **"Rate limit exceeded"**
   - –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 –º–∏–Ω—É—Ç—É
   - –û–±–Ω–æ–≤–∏—Ç–µ –ø–ª–∞–Ω –Ω–∞ Kie.ai

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
curl -H "Authorization: Bearer $KIE_AI_API_KEY" \
  https://api.kie.ai/api/v1/chat/credit

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f logs/combined.log | grep -i kie

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
npm run status
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Kie.ai](https://docs.kie.ai)
- [–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–º–ø—Ç–æ–≤](https://kie.ai/examples)
- [Playground –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](https://kie.ai/playground)
- [–ü–æ–¥–¥–µ—Ä–∂–∫–∞](https://kie.ai/support)

---

# üìã –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è RILS –ø–∞—Ä—Å–µ—Ä–∞

## üéØ –ó–ê–î–ê–ß–ê
–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π RILS –ø–∞—Ä—Å–µ—Ä (Instagram Apify Scraper) –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

## ‚úÖ –ì–û–¢–û–í–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### üìç –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ
- **–§–∞–π–ª:** `src/inngest-functions/instagramApifyScraper.ts`
- **–§—É–Ω–∫—Ü–∏—è:** `instagramApifyScraper`
- **–°–æ–±—ã—Ç–∏–µ:** `instagram/apify-scrape`
- **ID:** `instagram-apify-scraper`

### üîß API –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

#### –í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (event.data):
```typescript
{
  username_or_hashtag: string     // Instagram username –∏–ª–∏ hashtag
  project_id: number             // ID –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ë–î
  source_type: 'competitor' | 'hashtag'  // –¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞
  max_reels: number              // –ú–∞–∫—Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ reels (1-500, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
  min_views?: number             // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
  max_age_days?: number          // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –¥–Ω—è—Ö (1-365)
  requester_telegram_id?: string // Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  bot_name?: string              // –ò–º—è –±–æ—Ç–∞ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
}
```

#### –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞:
```javascript
const result = await inngest.send({
  name: 'instagram/apify-scrape',
  data: {
    username_or_hashtag: 'yacheslav_nekludov',
    project_id: 1,
    source_type: 'competitor',
    max_reels: 10,
    min_views: 1000,
    max_age_days: 30,
    requester_telegram_id: '144022504',
    bot_name: 'kie-ai-bot'
  }
})
```

### üõ†Ô∏è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** —Å –ø–æ–º–æ—â—å—é Zod
2. **–ü–∞—Ä—Å–∏–Ω–≥ Instagram reels** —á–µ—Ä–µ–∑ Apify API
3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL/Supabase** (—Ç–∞–±–ª–∏—Ü—ã: reels, reel_metrics, hashtags)
4. **–°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞** —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (Excel + –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã)
5. **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîó –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```bash
# Apify –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
APIFY_TOKEN=your_apify_token_here

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
NEON_DATABASE_URL=postgresql://...

# Telegram (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHAT_ID=...
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã

#### ‚úÖ –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
- [x] –§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑ –∫–æ–º–º–∏—Ç–∞ `e5f4550`
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/inngest-functions/index.ts`
- [x] –°–±–æ—Ä–∫–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ (286 —Ñ–∞–π–ª–æ–≤)
- [x] –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Inngest –∫–ª–∏–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω

#### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `APIFY_TOKEN` –≤ production –æ–∫—Ä—É–∂–µ–Ω–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ë–î (reels, reel_metrics, hashtags)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–º–∏—Ç—ã Apify API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã

### 3. Telegram Bot –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

#### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞:
```javascript
// –í Telegram –±–æ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
bot.command('parse_reels', async (ctx) => {
  const username = ctx.message.text.split(' ')[1]
  
  if (!username) {
    return ctx.reply('‚ùå –£–∫–∞–∂–∏—Ç–µ username: /parse_reels username')
  }
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Inngest
  const result = await inngest.send({
    name: 'instagram/apify-scrape',
    data: {
      username_or_hashtag: username,
      project_id: ctx.from.id, // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram ID –∫–∞–∫ project_id
      source_type: 'competitor',
      max_reels: 20,
      min_views: 500,
      max_age_days: 30,
      requester_telegram_id: ctx.from.id.toString(),
      bot_name: 'kie-ai-bot'
    }
  })
  
  ctx.reply(`‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–ø—É—â–µ–Ω! ID: ${result.ids[0]}`)
})
```

## üöÄ –ü–õ–ê–ù –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (1-2 —á–∞—Å–∞)
1. **–ü–æ–ª—É—á–∏—Ç—å Apify —Ç–æ–∫–µ–Ω** –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`
2. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –∫–æ–º–∞–Ω–¥—É** –≤ Telegram –±–æ—Ç–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –Ω–∞ –Ω–µ–±–æ–ª—å—à–æ–º –∞–∫–∫–∞—É–Ω—Ç–µ (5-10 reels)
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ** —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ –ë–î

### –≠—Ç–∞–ø 2: –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2-3 —á–∞—Å–∞)
1. **–î–æ–±–∞–≤–∏—Ç—å UI —ç–ª–µ–º–µ–Ω—Ç—ã** –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
2. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –±–∏–ª–ª–∏–Ω–≥–æ–º** (—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–µ–∑–¥/—Ç–æ–∫–µ–Ω–æ–≤)
3. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä** –∏ —Å—Ç–∞—Ç—É—Å –ø–∞—Ä—Å–∏–Ω–≥–∞
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

### –≠—Ç–∞–ø 3: Production –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å (1-2 —á–∞—Å–∞)
1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–∏–º–∏—Ç—ã** –∏ rate limiting
2. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üí∞ –ë–ò–õ–õ–ò–ù–ì –ò –õ–ò–ú–ò–¢–´

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ü–µ–Ω—ã:
- **10 reels** = 50 Telegram Stars (–±–∞–∑–æ–≤—ã–π –ø–∞–∫–µ—Ç)
- **50 reels** = 200 Telegram Stars (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π)
- **100 reels** = 350 Telegram Stars (–ø—Ä–µ–º–∏—É–º)

### –õ–∏–º–∏—Ç—ã:
- –ú–∞–∫—Å–∏–º—É–º 500 reels –∑–∞ –∑–∞–ø—Ä–æ—Å
- –ú–∞–∫—Å–∏–º—É–º 5 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —á–∞—Å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ 24 —á–∞—Å–∞

## üîç –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –ì–æ—Ç–æ–≤—ã–π —Ç–µ—Å—Ç:
```bash
# –§–∞–π–ª —Å–æ–∑–¥–∞–Ω: test-rils-parser.js
node test-rils-parser.js
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:
‚úÖ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ  
‚úÖ ID —Å–æ–±—ã—Ç–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è  
‚ö†Ô∏è –ù—É–∂–µ–Ω APIFY_TOKEN –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. **Apify —Ç–æ–∫–µ–Ω** –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–æ—Å—Ç—É–ø–Ω–∞
3. **Inngest —Å–µ—Ä–≤–∏—Å** –∑–∞–ø—É—â–µ–Ω
4. **–¢–∞–±–ª–∏—Ü—ã –ë–î** —Å–æ–∑–¥–∞–Ω—ã

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- Inngest Dashboard: `http://localhost:8288`
- –°–µ—Ä–≤–µ—Ä –ª–æ–≥–∏: `pm2 logs ai-server-main`
- –ë–î –∑–∞–ø—Ä–æ—Å—ã: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Supabase/Neon –∫–æ–Ω—Å–æ–ª–∏

---

**üéØ –ò–¢–û–ì:** RILS –ø–∞—Ä—Å–µ—Ä –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏. –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ APIFY_TOKEN –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ production.

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 19 –∞–≤–≥—É—Å—Ç–∞ 2025*