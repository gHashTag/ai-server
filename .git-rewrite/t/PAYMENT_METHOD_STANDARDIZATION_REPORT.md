# üéØ –û—Ç—á–µ—Ç: –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è payment_method

## üïâÔ∏è –ü—Ä–æ–±–ª–µ–º–∞
–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—è `payment_method`, —á—Ç–æ –Ω–∞—Ä—É—à–∞–ª–æ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ `payments_v2`.

### ‚ùå –ë—ã–ª–æ (—Ö–∞–æ—Ç–∏—á–Ω–æ):
- `'Training'` - –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π
- `'NeuroPhoto'` - –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `'TextToImage'` - –¥–ª—è text-to-image
- `'ImageToPrompt'` - –¥–ª—è image-to-prompt
- `'Robokassa'` - –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π —á–µ—Ä–µ–∑ Robokassa
- `'Internal'` - –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ï–¥–∏–Ω—ã–π –°—Ç–∞–Ω–¥–∞—Ä—Ç

### üìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π PaymentMethod —Ç–∏–ø:
```typescript
export type PaymentMethod =
  | 'Telegram'      // –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars
  | 'Robokassa'     // –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Robokassa (—Ä—É–±–ª–∏)
  | 'Internal'      // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞ —Å–µ—Ä–≤–∏—Å—ã)
  | 'System'        // –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–±–æ–Ω—É—Å—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã)
  | 'Manual'        // –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  | 'Unknown'       // –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –º–µ—Ç–æ–¥ (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π)
```

### üîÑ –ü—Ä–∞–≤–∏–ª–∞ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

| –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ | payment_method | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|----------------|----------|
| –°–ø–∏—Å–∞–Ω–∏–µ –∑–∞ —Å–µ—Ä–≤–∏—Å—ã | `'Internal'` | Model Training, NeuroPhoto, Text-to-Image, Image-to-Prompt |
| –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Robokassa | `'Robokassa'` | –ü–ª–∞—Ç–µ–∂–∏ –≤ —Ä—É–±–ª—è—Ö |
| –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram | `'Telegram'` | –ü–ª–∞—Ç–µ–∂–∏ –≤ Telegram Stars |
| –ë–æ–Ω—É—Å—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã | `'System'` | –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è |
| –†—É—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | `'Manual'` | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |

## üìä –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã

### 1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- ‚úÖ `src/interfaces/payments.interface.ts` - –û–±–Ω–æ–≤–ª–µ–Ω —Ç–∏–ø `PaymentMethod`

### 2. –°–µ—Ä–≤–∏—Å—ã (–≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `'Internal'`)
- ‚úÖ `src/services/generateModelTraining.ts`
- ‚úÖ `src/services/generateNeuroImage.ts` 
- ‚úÖ `src/services/generateImageToPrompt.ts`
- ‚úÖ `src/services/generateTextToImage.ts`

### 3. Inngest —Ñ—É–Ω–∫—Ü–∏–∏ (–≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `'Internal'`)
- ‚úÖ `src/inngest-functions/generateModelTraining.ts`
- ‚úÖ `src/inngest-functions/modelTrainingV2.ts`
- ‚úÖ `src/inngest-functions/neuroImageGeneration.ts`

### 4. Core —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ `src/core/supabase/updateUserBalance.ts` - –û–±–Ω–æ–≤–ª–µ–Ω—ã defaults

### 5. –¢–µ—Å—Ç—ã
- ‚úÖ `scripts/test-fixed-updateUserBalance.js` - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –¢–µ–ø–µ—Ä—å –≤ –ë–î:
```sql
-- –í—Å–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–ø–∏—Å–∞–Ω–∏—è –∑–∞ —Å–µ—Ä–≤–∏—Å—ã)
payment_method = 'Internal'

-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Robokassa
payment_method = 'Robokassa'

-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram
payment_method = 'Telegram'

-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–±–æ–Ω—É—Å—ã, –≤–æ–∑–≤—Ä–∞—Ç—ã)
payment_method = 'System'
```

### üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –µ–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏** - –ª–µ–≥–∫–æ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Ç–∏–ø–∞–º –ø–ª–∞—Ç–µ–∂–µ–π
3. **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º –ø–ª–∞—Ç–µ–∂–µ–π
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### üîç –ü—Ä–∏–º–µ—Ä—ã –≤ –ë–î:
```sql
-- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏
payment_method = 'Internal', service_type = 'DIGITAL_AVATAR_BODY'

-- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π  
payment_method = 'Internal', service_type = 'NEURO_PHOTO'

-- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
payment_method = 'Robokassa', service_type = NULL

-- –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
payment_method = 'System', service_type = NULL
```

## üéâ –ò—Ç–æ–≥
‚úÖ **–ü–æ—Ä—è–¥–æ–∫ –Ω–∞–≤–µ–¥–µ–Ω!** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è `payment_method`, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–æ—â–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

---
**–î–∞—Ç–∞:** 26 –º–∞—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û  
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** –¢–∏–ø—ã ‚úÖ, –¢–µ—Å—Ç—ã ‚úÖ, –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å ‚úÖ 