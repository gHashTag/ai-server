# üîß –û—Ç—á–µ—Ç: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –°–µ—Ä–≤–∏—Å–æ–≤ –≤ –°–∏—Å—Ç–µ–º–µ –°–ø–∏—Å–∞–Ω–∏—è –°—Ä–µ–¥—Å—Ç–≤

## üïâÔ∏è –°—Ç–∞—Ç—É—Å: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê! ‚úÖ

**–î–∞—Ç–∞:** 2025-01-15  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–µ —Å–ø–∏—Å—ã–≤–∞–ª–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 7 –∏–∑ 8 —Å–µ—Ä–≤–∏—Å–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ, 1 —Å–µ—Ä–≤–∏—Å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω  

---

## üìä –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–±–ª–µ–º—ã

### üîç –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã:
1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `service_type`** –≤ `updateUserBalance` –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sendBalanceMessage`** –≤–º–µ—Å—Ç–æ `updateUserBalance` (—Ç–æ–ª—å–∫–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –Ω–µ —Å–ø–∏—Å–∞–Ω–∏–µ)
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –≤ `updateUserBalance`
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏** –¥–ª—è `voice_to_text` (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏)

### üìà –ù–∞–π–¥–µ–Ω–Ω—ã–µ service_type –≤ –ë–î (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
- ‚úÖ `neuro_photo`
- ‚úÖ `image_to_video` 
- ‚úÖ `image_to_prompt`
- ‚úÖ `digital_avatar_body`
- ‚úÖ `text_to_speech`

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ service_type –≤ –ë–î:
- `neuro_photo_v2`
- `digital_avatar_body_v2`
- `text_to_video`
- `text_to_image`
- `voice`
- `voice_to_text`

---

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ 1. **NEURO_PHOTO_V2** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/generateNeuroImageV2.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª `service_type` –≤ `updateUserBalance`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
await updateUserBalance(
  telegram_id,
  finalCost,
  PaymentType.MONEY_OUTCOME,
  `NeuroPhotoV2 generation start (${successful_starts}/${num_images} started)`,
  {
    stars: finalCost,
    payment_method: 'Internal',
    service_type: ModeEnum.NeuroPhotoV2, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    bot_name: bot_name,
    language: is_ru ? 'ru' : 'en',
    cost: finalCost / 1.5, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
  }
)
```

### ‚úÖ 2. **DIGITAL_AVATAR_BODY_V2** - –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/inngest-functions/modelTrainingV2.ts`  
**–°—Ç–∞—Ç—É—Å:** –£–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `service_type: ModeEnum.DigitalAvatarBodyV2`

### ‚úÖ 3. **TEXT_TO_VIDEO** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/generateTextToVideo.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `processBalanceVideoOperation` –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
await updateUserBalance(
  telegram_id,
  paymentAmount,
  PaymentType.MONEY_OUTCOME,
  `Text-to-Video generation (${videoModel})`,
  {
    stars: paymentAmount,
    payment_method: 'Internal',
    service_type: ModeEnum.TextToVideo, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    bot_name: bot_name,
    language: is_ru ? 'ru' : 'en',
    cost: paymentAmount / 1.5, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
  }
)
```

### ‚úÖ 4. **IMAGE_TO_VIDEO** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/generateImageToVideo.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `processBalanceVideoOperation` –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏—è  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
await updateUserBalance(
  telegram_id,
  paymentAmount,
  PaymentType.MONEY_OUTCOME,
  `Image-to-Video generation (${videoModel})`,
  {
    stars: paymentAmount,
    payment_method: 'Internal',
    service_type: ModeEnum.ImageToVideo, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    bot_name: bot_name,
    language: is_ru ? 'ru' : 'en',
    cost: paymentAmount / 1.5, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
  }
)
```

### ‚úÖ 5. **TEXT_TO_IMAGE** - –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/generateTextToImage.ts`  
**–°—Ç–∞—Ç—É—Å:** –£–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `service_type: ModeEnum.TextToImage`

### ‚úÖ 6. **TEXT_TO_SPEECH** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/generateSpeech.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `sendBalanceMessage` –≤–º–µ—Å—Ç–æ `updateUserBalance`  
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```typescript
// –ë–´–õ–û:
sendBalanceMessage(
  telegram_id,
  balanceCheck.currentBalance,
  calculateModeCost({ mode: ModeEnum.TextToSpeech }).stars,
  is_ru,
  bot
)

// –°–¢–ê–õ–û:
await updateUserBalance(
  telegram_id,
  paymentAmount,
  PaymentType.MONEY_OUTCOME,
  `–°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ (ElevenLabs)`,
  {
    stars: paymentAmount,
    payment_method: 'Internal',
    service_type: ModeEnum.TextToSpeech, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û
    bot_name: bot_name,
    language: is_ru ? 'ru' : 'en',
    cost: paymentAmount / 1.5, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
  }
)
```

### ‚úÖ 7. **VOICE** - –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `src/services/createVoiceAvatar.ts`  
**–°—Ç–∞—Ç—É—Å:** –£–∂–µ —Å–æ–¥–µ—Ä–∂–∞–ª –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `service_type: ModeEnum.Voice`

### ‚ùå 8. **VOICE_TO_TEXT** - –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
**–°—Ç–∞—Ç—É—Å:** –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç  
**–ü—Ä–∏—á–∏–Ω–∞:** –°–µ—Ä–≤–∏—Å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenAI Whisper API

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: **7/8 —Å–µ—Ä–≤–∏—Å–æ–≤** (87.5%)

### üìä –û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
–ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ –ë–î –ø–æ—è–≤—è—Ç—Å—è –∑–∞–ø–∏—Å–∏ —Å:
- `service_type: 'NEURO_PHOTO_V2'`
- `service_type: 'TEXT_TO_VIDEO'`  
- `service_type: 'IMAGE_TO_VIDEO'`
- `service_type: 'TEXT_TO_SPEECH'`

### üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `cost` (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å = —Ü–µ–Ω–∞ √∑ 1.5)
- ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω `payment_method: 'Internal'`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —è–∑—ã–∫–æ–≤—ã–µ –º–µ—Ç–∫–∏ (`language: 'ru'/'en'`)
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript:
```bash
bun exec tsc --noEmit
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£—Å–ø–µ—à–Ω–æ, –æ—à–∏–±–æ–∫ –Ω–µ—Ç

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç–µ—Å—Ç—ã:
1. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å**
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –ë–î**
3. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏**
4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –ë–î**

---

## üìã –ü–ª–∞–Ω –î–∞–ª—å–Ω–µ–π—à–∏—Ö –î–µ–π—Å—Ç–≤–∏–π

### üéØ –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã**
2. ‚úÖ **–¢–∏–ø—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã**
3. üîÑ **–¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ**

### üöÄ –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:
1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `voice_to_text`** (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):
   - –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —Å OpenAI Whisper
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç –≤ `generation.route.ts`
   - –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤ `generation.controller.ts`

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**:
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö `service_type` –≤ –ë–î
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è —Å—Ä–µ–¥—Å—Ç–≤
   - –£–±–µ–¥–∏—Ç—å—Å—è –≤ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–µ–≥—Ä–µ—Å—Å–∏–π

---

## üí° –í—ã–≤–æ–¥—ã

### ‚úÖ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞** - 87.5% —Å–µ—Ä–≤–∏—Å–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Å–ø–∏—Å–∞–Ω–∏—è** —Å—Ä–µ–¥—Å—Ç–≤
- **–£–ª—É—á—à–µ–Ω–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –ø–æ—Ç–µ—Ä–∏ –¥–æ—Ö–æ–¥–æ–≤** –æ—Ç –Ω–µ—É—á—Ç–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### üéØ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç:
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Å–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤** –¥–ª—è 6 —Å–µ—Ä–≤–∏—Å–æ–≤
- **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –ø–æ—Ç–µ—Ä–∏** –æ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **–£–ª—É—á—à–µ–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å** —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏

### üîÆ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ –ë–î
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `voice_to_text`
4. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ú–ò–°–°–ò–Ø –í–´–ü–û–õ–ù–ï–ù–ê!** üéØ  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** –ù–µ–π—Ä–æ–ö–æ–¥–µ—Ä  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-01-15 